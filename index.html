<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>에니어그램 자가 진단 테스트 by @peace_shiny</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Gaegu:wght@400;700&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #db2777;
            --primary-light: #fdf2f8;
            --secondary: #4f46e5;
            --bg-color: #f9fafb;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--bg-color);
            color: #1f2937;
            -webkit-tap-highlight-color: transparent;
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }

        .gaegu { font-family: 'Gaegu', cursive; }

        #test-container {
            background-color: #ffffff;
            border-radius: 24px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.04), 0 8px 10px -6px rgba(0, 0, 0, 0.04);
        }

        .progress-container {
            width: 100%;
            height: 6px;
            background-color: #f3f4f6;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 2rem;
        }
        #progress-bar {
            height: 100%;
            background-color: var(--primary);
            width: 0%;
            transition: width 0.4s ease-out;
        }

        .question-group {
            margin-bottom: 2.5rem;
        }
        .group-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #111827;
            margin-bottom: 1.25rem;
            display: flex;
            align-items: center;
        }
        .group-title::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 20px;
            background-color: var(--primary);
            margin-right: 10px;
            border-radius: 2px;
        }

        .question-item {
            background-color: #ffffff;
            border: 1px solid #f3f4f6;
            padding: 1.5rem;
            border-radius: 18px;
            margin-bottom: 1.25rem;
            transition: all 0.2s ease;
        }
        .question-item:hover {
            border-color: #e5e7eb;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03);
        }
        .question-text {
            font-size: 1.05rem;
            font-weight: 400;
            color: #374151;
            margin-bottom: 1.25rem;
        }

        .rating-guide {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: #9ca3af;
            margin-bottom: 0.5rem;
            padding: 0 4px;
        }

        .rating-grid {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
        }
        .rating-grid label {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.85rem 0;
            background-color: #f9fafb;
            border: 1px solid #f3f4f6;
            border-radius: 14px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            color: #6b7280;
            transition: all 0.2s;
        }
        .rating-grid input:checked + label {
            background-color: var(--primary-light);
            border-color: var(--primary);
            color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(219, 39, 119, 0.1);
        }
        .rating-grid input { display: none; }

        .nav-buttons {
            display: flex;
            gap: 16px;
            margin-top: 2.5rem;
        }
        .btn {
            flex: 1;
            padding: 1.1rem;
            border-radius: 16px;
            font-weight: 700;
            font-size: 1.1rem;
            transition: all 0.2s;
            cursor: pointer;
            text-align: center;
            border: none;
        }
        .btn-prev {
            background-color: #f3f4f6;
            color: #6b7280;
        }
        .btn-next {
            background-color: var(--primary);
            color: white;
            box-shadow: 0 4px 14px 0 rgba(219, 39, 119, 0.25);
        }
        .btn:active { transform: scale(0.97); }

        #options-area {
            max-height: 55vh;
            overflow-y: auto;
            padding-right: 12px;
            margin-bottom: 1.5rem;
        }
        #options-area::-webkit-scrollbar { width: 5px; }
        #options-area::-webkit-scrollbar-thumb { background: #e5e7eb; border-radius: 10px; }

        .result-card {
            border-radius: 24px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            border: 1px solid #f3f4f6;
            background: white;
        }
        .result-card h3 {
            font-weight: 700;
            font-size: 1.4rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .result-body {
            font-size: 0.95rem;
            color: #4b5563;
            line-height: 1.8;
            white-space: pre-line;
        }

        @media (max-width: 640px) {
            #test-container { padding: 1.5rem; border-radius: 0; min-height: 100vh; }
            #options-area { max-height: none; overflow: visible; }
            .rating-grid label { padding: 0.75rem 0; font-size: 0.85rem; }
            header h1 { font-size: 2.5rem; }
        }
    </style>
</head>
<body class="py-0 sm:py-10 flex justify-center items-start">
    <div id="test-container" class="w-full max-w-2xl p-8 sm:p-12">
        <header class="text-center mb-10">
            <h1 class="gaegu text-5xl text-pink-600 mb-3">나를 찾는 여정</h1>
            <p class="text-gray-400 text-sm uppercase tracking-widest">Enneagram Deep Analysis</p>
        </header>

        <div id="quiz-ui">
            <div class="progress-container">
                <div id="progress-bar"></div>
            </div>
            
            <div id="step-indicator" class="text-xs font-bold text-pink-500 uppercase tracking-widest mb-2"></div>
            <h2 id="step-title" class="gaegu text-3xl text-gray-800 mb-2"></h2>
            <p id="step-desc" class="text-sm text-gray-400 mb-6">1점(전혀 아님) ~ 5점(매우 그러함) 사이로 체크해주세요.</p>
            
            <div id="options-area">
                <!-- 질문 영역 -->
            </div>

            <div class="nav-buttons">
                <button id="prev-button" class="btn btn-prev hidden gaegu">이전으로</button>
                <button id="next-button" class="btn btn-next gaegu">계속하기</button>
            </div>
            <div id="error-message" class="text-red-400 text-xs mt-6 text-center hidden">아직 답변하지 않은 항목이 있습니다.</div>
        </div>

        <div id="result-area" class="hidden">
            <h2 class="gaegu text-4xl text-center text-gray-800 mb-10">내면의 목소리에 귀를 기울여 보세요</h2>
            <div id="result-content"></div>
            <button id="restart-button" class="btn btn-next w-full mt-10 gaegu text-xl">여정 다시 시작하기</button>
        </div>

        <footer class="mt-16 text-center text-gray-300 text-xs gaegu">
            Designed with Heart by @peace_shiny
        </footer>
    </div>

    <script>
        const enneagramData = {
            centers: [ 
                { 
                    id: "heart", 
                    name: "가슴형 (감정 중심 - Heart Center)", 
                    description: "가슴형은 세상을 '감정'과 '관계'를 통해 파악합니다. 이들의 삶에서 가장 중요한 화두는 '나는 타인에게 어떻게 비춰지는가?'와 '나는 가치 있는 사람인가?'입니다.\n\n• 주요 감정: 수치심 (자신이 부족하거나 무가치해 보일까 봐 두려워함)\n• 대응 방식: 타인에게 좋은 이미지를 심어주거나, 사랑받을 수 있는 역할을 자처함으로써 자신의 존재 가치를 증명하려 합니다.\n• 특징: 공감 능력이 뛰어나고 정서적 연결을 중시하지만, 지나치게 타인의 평가에 의존할 수 있습니다.", 
                    types: [2, 3, 4] 
                },
                { 
                    id: "head", 
                    name: "머리형 (사고 중심 - Head Center)", 
                    description: "머리형은 세상을 '정보'와 '논리'를 통해 이해하려 합니다. 불확실한 미래에 대비하여 안전을 확보하는 것이 이들의 가장 큰 욕구입니다.\n\n• 주요 감정: 두려움 (불안정한 환경이나 정보 부족으로 인해 고립될까 봐 걱정함)\n• 대응 방식: 상황을 분석하고 지식을 쌓거나, 미래의 위험을 미리 예측하여 전략을 세움으로써 안심하려 합니다.\n• 특징: 객관적이고 전략적이며 예지력이 있지만, 생각에만 머물러 실행력이 떨어지거나 불안에 잠식될 수 있습니다.", 
                    types: [5, 6, 7] 
                },
                { 
                    id: "gut", 
                    name: "장형 (본능 중심 - Gut Center)", 
                    description: "장형은 세상을 '본능'과 '직관'으로 받아들입니다. 자신의 존재감을 지탱하고 주변 환경을 통제하여 자율성을 확보하는 것이 핵심입니다.\n\n• 주요 감정: 분노 (자신의 경계가 침범당하거나 공정하지 못한 대우를 받을 때 폭발함)\n• 대응 방식: 직접적인 행동을 통해 환경을 장악하거나, 원칙을 고수함으로써 자신의 영역과 정의를 지키려 합니다.\n• 특징: 현실적이고 추진력이 강하며 책임감이 있지만, 고집이 세거나 무의식적으로 분노를 억압할 수 있습니다.", 
                    types: [8, 9, 1] 
                }
            ],
            centerIdentificationGroups: [
                { groupId: "groupA", groupName: "관계와 이미지 (감정적 반응)", questions: [
                    { text: "주변 사람들의 기분이나 감정 상태를 본능적으로 감지한다.", id: "ci_A_1", centerTarget: "heart" },
                    { text: "타인에게 좋은 평판을 얻고 인정받는 것이 나에게 큰 힘이 된다.", id: "ci_A_2", centerTarget: "heart" },
                    { text: "내가 다른 사람들에게 어떤 모습으로 비쳐질지 자주 고민한다.", id: "ci_A_3", centerTarget: "heart" },
                    { text: "관계를 위해 때로는 내 진짜 감정보다 상대가 원하는 감정을 표현한다.", id: "ci_A_4", centerTarget: "heart" },
                    { text: "내가 다른 사람과 구별되는 특별한 존재라고 느껴질 때 만족스럽다.", id: "ci_A_5", centerTarget: "heart" }
                ]},
                { groupId: "groupB", groupName: "분석과 안전 (사고적 반응)", questions: [
                    { text: "결정하기 전에 발생 가능한 모든 변수를 분석하고 정보를 모은다.", id: "ci_B_1", centerTarget: "head" },
                    { text: "앞으로 일어날 수 있는 부정적인 상황에 대해 미리 대비하는 편이다.", id: "ci_B_2", centerTarget: "head" },
                    { text: "복잡한 세상을 논리적으로 이해했을 때 가장 안도감을 느낀다.", id: "ci_B_3", centerTarget: "head" },
                    { text: "지적 자산이나 정보가 부족하면 상황을 통제하기 어렵다고 느낀다.", id: "ci_B_4", centerTarget: "head" },
                    { text: "문제가 생기면 감정보다는 원인과 해결책을 먼저 생각한다.", id: "ci_B_5", centerTarget: "head" }
                ]},
                { groupId: "groupC", groupName: "통제와 자율성 (본능적 반응)", questions: [
                    { text: "상황이 내 의지대로 흘러가지 않으면 강한 거부감을 느낀다.", id: "ci_C_1", centerTarget: "gut" },
                    { text: "부당한 지시나 통제를 받을 때 참지 않고 직접적으로 반응한다.", id: "ci_C_2", centerTarget: "gut" },
                    { text: "복잡한 분석보다는 내 몸이 느끼는 직관적인 감각을 더 신뢰한다.", id: "ci_C_3", centerTarget: "gut" },
                    { text: "내 영역과 경계를 지키는 것이 나에게는 생존만큼 중요하다.", id: "ci_C_4", centerTarget: "gut" },
                    { text: "말보다는 행동으로 보여주는 것이 가장 확실한 방법이라 믿는다.", id: "ci_C_5", centerTarget: "gut" }
                ]}
            ],
            types: { 
                1: { 
                    name: "1번: 개혁가 (The Reformer)", 
                    description: "1번 유형은 매사에 완벽을 기하며, 세상이 더 정의롭고 올바른 방향으로 나아가길 갈망합니다.\n\n• 핵심 동기: 옳고 정당한 사람이 되는 것, 자신의 양심에 비추어 부끄럽지 않은 삶을 사는 것.\n• 근원적 공포: 악하고 부패하며 결함이 있는 사람이 되는 것.\n• 건강할 때: 매우 분별력 있고 공정하며, 높은 도덕적 기준을 실천으로 보여주는 현명한 지도자가 됩니다.\n• 스트레스 받을 때: 4번 유형처럼 변덕스러워지며, '나만 왜 이렇게 고생하나'라는 피해의식과 우울감에 빠질 수 있습니다.\n\n💡 성장 포인트: 당신 안의 '비판자'를 잠재우세요. 완벽하지 않아도 당신은 충분히 가치 있는 존재입니다.", 
                    subtypes: {
                        sp: { name: "자기보존형 (열정적인 걱정꾼)", description: "자신의 주변 환경과 건강, 재정을 완벽하게 관리하여 불안을 해소하려 합니다. 세부 사항에 매우 집착하며 스스로에게 가장 엄격합니다.", questions: [{ text: "나의 건강과 안전, 재정 상태를 완벽하게 관리하려 노력한다.", id: "st_1_sp_1" }, { text: "주변 환경의 작은 무질서도 참기 힘들고 즉시 바로잡고 싶다.", id: "st_1_sp_2" }] },
                        sx: { name: "일대일형 (열성적인 전도사)", description: "가까운 파트너나 친구가 '더 나은 사람'이 되도록 개선하려는 욕구가 강합니다. 자신의 이상을 상대에게 투영하며 강한 정서적 열망을 보입니다.", questions: [{ text: "사랑하는 사람의 단점을 보면 고쳐주고 싶은 강한 욕구가 생긴다.", id: "st_1_sx_1" }, { text: "관계에서도 도덕적이고 올바른 기준이 반드시 지켜져야 한다.", id: "st_1_sx_2" }] },
                        so: { name: "사회적형 (모범적인 스승)", description: "사회의 규칙과 시스템을 개선하는 데 헌신합니다. 타인에게 올바른 길을 제시하는 교육자나 리더로서의 면모가 뚜렷합니다.", questions: [{ text: "사회적 정의와 공정한 시스템을 만드는 일에 관심이 많다.", id: "st_1_so_1" }, { text: "모두가 지켜야 할 올바른 기준을 제시하는 것을 중요하게 여긴다.", id: "st_1_so_2" }] }
                    }
                },
                2: { 
                    name: "2번: 조력가 (The Helper)", 
                    description: "2번 유형은 사랑을 주고받는 관계에서 가장 큰 에너지를 얻습니다. 타인의 필요를 채워줌으로써 자신의 가치를 인정받으려 합니다.\n\n• 핵심 동기: 사랑받는 것, 다른 사람에게 필요한 존재가 되어 자신의 가치를 확인하는 것.\n• 근원적 공포: 아무도 나를 원하지 않고 사랑하지 않는 것.\n• 건강할 때: 진심으로 헌신적이며, 아무런 보상 없이도 깊은 사랑을 실천하는 이타적인 사람이 됩니다.\n• 스트레스 받을 때: 8번 유형처럼 돌변하여, 자신이 준 사랑에 대한 보상을 강요하거나 갑자기 화를 낼 수 있습니다.\n\n💡 성장 포인트: 당신의 욕구를 먼저 챙기세요. 남을 돕지 않아도 당신은 사랑받기에 충분합니다.", 
                    subtypes: {
                        sp: { name: "자기보존형 (귀여운 특권층)", description: "매력을 발산하여 타인이 자신을 보살피도록 유도합니다. '아이 같은 매력'으로 보호받기를 원하며 자신의 안락함을 중시합니다.", questions: [{ text: "내가 사랑받을 수 있게끔 귀엽거나 매력적인 모습을 보이려 한다.", id: "st_2_sp_1" }, { text: "다른 사람이 나를 위해 특별한 무언가를 해주길 은근히 기대한다.", id: "st_2_sp_2" }] },
                        sx: { name: "일대일형 (매혹적인 유혹자)", description: "특정 한 사람의 마음을 완전히 사로잡는 것에 집중합니다. 상대가 자신을 갈망하게 함으로써 자신의 매력을 확인하려 합니다.", questions: [{ text: "한 사람과의 깊고 강렬한 감정적 연결에 모든 에너지를 쏟는다.", id: "st_2_sx_1" }, { text: "상대가 나 없이는 안 되게끔 만드는 것에 자부심을 느낀다.", id: "st_2_sx_2" }] },
                        so: { name: "사회적형 (영향력 있는 리더)", description: "큰 집단이나 공동체 내에서 '모두의 친구'나 '해결사'가 되어 인정받으려 합니다. 권위 있는 사람들과의 연결을 중요시합니다.", questions: [{ text: "많은 사람들 사이에서 영향력 있는 조력자가 되고 싶어 한다.", id: "st_2_so_1" }, { text: "중요한 모임에서 핵심적인 역할을 수행할 때 가치를 느낀다.", id: "st_2_so_2" }] }
                    }
                },
                3: { 
                    name: "3번: 성취가 (The Achiever)", 
                    description: "3번 유형은 목표를 달성하고 성공적인 이미지를 구축하는 데 탁월합니다. 세상의 박수와 찬사가 이들의 원동력입니다.\n\n• 핵심 동기: 유능해 보이는 것, 경쟁에서 이기는 것, 성공한 이미지로 인정받는 것.\n• 근원적 공포: 가치 없는 사람이 되는 것, 실패자로 낙인찍히는 것.\n• 건강할 때: 자기 수용적이고 진실하며, 타인에게 영감을 주는 매력적인 리더가 됩니다.\n• 스트레스 받을 때: 9번 유형처럼 무기력해지며, 목표를 잃고 멍하니 시간을 보내거나 회피할 수 있습니다.\n\n💡 성장 포인트: 결과보다는 과정을 즐기세요. 성공하지 않아도 당신의 존재 자체는 빛납니다.", 
                    subtypes: {
                        sp: { name: "자기보존형 (안정적인 일중독)", description: "성공을 통해 경제적 안정과 안전을 확보하는 데 집중합니다. 화려한 과시보다는 실질적인 실력을 쌓는 자수성가형입니다.", questions: [{ text: "내 능력으로 물질적인 기반을 탄탄히 다지는 것이 가장 중요하다.", id: "st_3_sp_1" }, { text: "성과를 내기 위해 휴식을 미루고 일에 몰두하는 경향이 있다.", id: "st_3_sp_2" }] },
                        sx: { name: "일대일형 (환상적인 짝꿍)", description: "자신이 매력적인 사람이 되는 것만큼이나, 매력적인 파트너의 성공을 돕거나 그들과 연결되는 것을 통해 가치를 증명합니다.", questions: [{ text: "타인에게 선망의 대상이 되는 이미지를 만드는 것을 즐긴다.", id: "st_3_sx_1" }, { text: "내가 사랑하는 사람이 성공하도록 돕는 것에서 큰 만족을 얻는다.", id: "st_3_sx_2" }] },
                        so: { name: "사회적형 (명예로운 아이콘)", description: "사회적 지위와 명성을 중시합니다. 집단 내에서 가장 뛰어난 사람으로 인정받기 위해 끊임없이 자신을 갈고 닦습니다.", questions: [{ text: "사회적으로 높은 지위에 올라 명성을 쌓는 것이 나의 꿈이다.", id: "st_3_so_1" }, { text: "많은 이들이 우러러보는 성공 모델이 되고자 끊임없이 노력한다.", id: "st_3_so_2" }] }
                    }
                },
                4: { 
                    name: "4번: 개인주의자 (The Individualist)", 
                    description: "4번 유형은 자신의 내면을 깊이 탐구하며, 독창적이고 아름다운 자신만의 세계를 구축하려 합니다.\n\n• 핵심 동기: 자신만의 고유한 정체성을 찾는 것, 감정의 깊이를 경험하는 것.\n• 근원적 공포: 평범해지는 것, 정체성이 없거나 자신을 이해받지 못하는 것.\n• 건강할 때: 창의적이고 직관력이 뛰어나며, 고통 속에서도 아름다움을 찾아내는 예술적인 영혼이 됩니다.\n• 스트레스 받을 때: 2번 유형처럼 변하여, 다른 사람의 관심을 끌기 위해 지나치게 의존하거나 감정적으로 매달릴 수 있습니다.\n\n💡 성장 포인트: 현재의 행복을 직면하세요. 당신은 이미 충분히 특별하고 온전합니다.", 
                    subtypes: {
                        sp: { name: "자기보존형 (강인한 예술가)", description: "고통을 내면으로 삭히며 묵묵히 견디는 힘을 보여줍니다. 겉으로는 무덤덤해 보일 수 있지만 내면은 매우 치열하고 고독합니다.", questions: [{ text: "힘든 일이 있어도 남에게 알리지 않고 혼자 묵묵히 견딘다.", id: "st_4_sp_1" }, { text: "어려운 상황 속에서도 나만의 우아함과 강인함을 잃지 않으려 한다.", id: "st_4_sp_2" }] },
                        sx: { name: "일대일형 (격정적인 투사)", description: "질투와 선망의 에너지를 외부로 표출합니다. 자신이 갖지 못한 것에 대한 분노를 경쟁이나 강렬한 관계를 통해 해소하려 합니다.", questions: [{ text: "나를 이해하지 못하는 사람이나 세상에 대해 강한 반항심을 느낀다.", id: "st_4_sx_1" }, { text: "관계에서 매우 강렬한 감정의 기복을 드러내며 특별함을 확인한다.", id: "st_4_sx_2" }] },
                        so: { name: "사회적형 (부드러운 이방인)", description: "자신의 부족함이나 다름을 사회적으로 드러내며 공감을 구합니다. 집단 속에서도 '나는 소속되지 못했다'는 느낌을 품고 살아갑니다.", questions: [{ text: "사회적으로 소외된 느낌을 받을 때가 많고 이를 숨기지 않는다.", id: "st_4_so_1" }, { text: "나의 아픔을 이해해 줄 소수의 깊은 유대를 갈망한다.", id: "st_4_so_2" }] }
                    }
                },
                5: { 
                    name: "5번: 탐구가 (The Investigator)", 
                    description: "5번 유형은 지식을 통해 세상을 이해하고 통제하려 합니다. 독립적이며 통찰력이 뛰어나지만, 에너지 낭비를 꺼립니다.\n\n• 핵심 동기: 유능하고 지적인 사람이 되는 것, 세상의 원리를 파악하여 불안을 없애는 것.\n• 근원적 공포: 쓸모없고 무능해지는 것, 세상에 압도당하는 것.\n• 건강할 때: 선구적이고 예지력이 있으며, 복잡한 지식을 통합하여 인류에게 유익한 통찰을 제공하는 학자가 됩니다.\n• 스트레스 받을 때: 7번 유형처럼 변하여, 현실을 도피하기 위해 산만해지고 쾌락이나 자극적인 활동에 집착할 수 있습니다.\n\n💡 성장 포인트: 당신의 지혜를 세상과 나누세요. 지식은 공유될 때 진정한 힘을 발휘합니다.", 
                    subtypes: {
                        sp: { name: "자기보존형 (은둔하는 수집가)", description: "자신만의 성(Castle)을 구축하고 자원을 아끼는 데 집중합니다. 사생활을 극도로 보호하며 외부의 침입을 경계합니다.", questions: [{ text: "나만의 독립된 공간과 충분한 자원을 확보하는 것이 생존 전략이다.", id: "st_5_sp_1" }, { text: "외부와 단절된 채 혼자 지식을 쌓는 시간이 가장 편안하다.", id: "st_5_sp_2" }] },
                        sx: { name: "일대일형 (비밀스러운 동반자)", description: "모든 것을 공유할 수 있는 '영혼의 단짝'을 찾습니다. 신뢰하는 단 한 사람에게만 자신의 모든 지식과 내면을 쏟아붓습니다.", questions: [{ text: "나의 모든 비밀을 공유할 수 있는 특별한 한 사람을 갈망한다.", id: "st_5_sx_1" }, { text: "깊은 지적 교감이 가능한 상대에게는 모든 것을 헌신한다.", id: "st_5_sx_2" }] },
                        so: { name: "사회적형 (지식의 전수자)", description: "특정 분야의 전문가 집단에서 자신의 위치를 찾으려 합니다. 거대 담론이나 학문적 체계에 기여하는 것에 가치를 둡니다.", questions: [{ text: "나의 전문 지식이 특정 집단이나 학계에서 인정받기를 원한다.", id: "st_5_so_1" }, { text: "세상의 원리를 분석하여 보편적인 비전을 제시하는 것을 즐긴다.", id: "st_5_so_2" }] }
                    }
                },
                6: { 
                    name: "6번: 충성가 (The Loyalist)", 
                    description: "6번 유형은 안전과 안정을 최우선으로 하며, 신뢰할 수 있는 사람이나 시스템에 헌신합니다.\n\n• 핵심 동기: 지지와 안전을 얻는 것, 확실한 가이드라인 안에서 안심하는 것.\n• 근원적 공포: 도움이나 인도 없이 버려지는 것, 안전망이 사라지는 것.\n• 건강할 때: 자립심이 강하고 용기 있으며, 공동체를 위해 헌신하는 믿음직한 파수꾼이 됩니다.\n• 스트레스 받을 때: 3번 유형처럼 변하여, 불안을 감추기 위해 과도하게 바빠지고 성과에 집착하며 경쟁적으로 변할 수 있습니다.\n\n💡 성장 포인트: 스스로의 직관을 믿으세요. 정답은 외부가 아닌 당신 안에 있습니다.", 
                    subtypes: {
                        sp: { name: "자기보존형 (신중한 수호자)", description: "따뜻한 관계를 맺어 동맹군을 확보함으로써 불안을 관리합니다. 위험을 미리 감지하고 조심스럽게 행동하는 실무자형입니다.", questions: [{ text: "나를 지켜줄 수 있는 사람들과 우호적인 관계를 맺으려 노력한다.", id: "st_6_sp_1" }, { text: "잠재적인 위험에 대비해 늘 신중하고 꼼꼼하게 계획을 세운다.", id: "st_6_sp_2" }] },
                        sx: { name: "일대일형 (강인한 반항아)", description: "두려움에 정면으로 맞서기 위해 강해지려 합니다(공포 대항형). 때로는 공격적이거나 도전적인 태도로 자신의 안전을 확인받으려 합니다.", questions: [{ text: "두려울수록 더 강하게 몰아붙이거나 공격적인 태도를 취하곤 한다.", id: "st_6_sx_1" }, { text: "나를 지켜줄 만큼 강한 파트너를 원하거나 내가 그들을 시험한다.", id: "st_6_sx_2" }] },
                        so: { name: "사회적형 (원칙의 신봉자)", description: "확실한 법, 규칙, 신념 체계에 의존합니다. 공동체의 가이드라인을 철저히 준수하며 소속감에서 안정감을 얻습니다.", questions: [{ text: "공동의 규칙이나 신념을 지키는 것이 사회를 지탱하는 힘이라 믿는다.", id: "st_6_so_1" }, { text: "확실한 지침이나 권위 있는 리더가 있을 때 마음이 놓인다.", id: "st_6_so_2" }] }
                    }
                },
                7: { 
                    name: "7번: 열정가 (The Enthusiast)", 
                    description: "7번 유형은 삶의 즐거움과 무한한 가능성을 탐험하는 모험가입니다. 낙천적이며 고통을 멀리하려 합니다.\n\n• 핵심 동기: 행복하고 만족스러운 것, 새로운 것을 경험하며 삶의 즐거움을 극대화하는 것.\n• 근원적 공포: 고통받는 것, 결핍을 겪는 것, 선택의 자유를 제한당하는 것.\n• 건강할 때: 매사에 감사하고 열정적이며, 삶의 경이로움을 타인에게 전파하는 행복 전도사가 됩니다.\n• 스트레스 받을 때: 1번 유형처럼 변하여, 갑자기 비판적이 되고 냉소적이며 타인의 사소한 실수를 지적하거나 강박적으로 변할 수 있습니다.\n\n💡 성장 포인트: 현재에 머무르세요. 아픔을 직면할 때 당신은 진정한 자유를 얻게 됩니다.", 
                    subtypes: {
                        sp: { name: "자기보존형 (실속 있는 기회주의자)", description: "즐거움을 추구하되 실질적인 이익과 안락함을 놓치지 않습니다. 인맥과 자원을 동원하여 자신의 네트워크를 구축하는 데 능합니다.", questions: [{ text: "나에게 실질적인 이득과 즐거움을 동시에 줄 기회를 잘 찾아낸다.", id: "st_7_sp_1" }, { text: "안락한 생활을 유지하기 위한 현실적인 네트워크 관리에 능숙하다.", id: "st_7_sp_2" }] },
                        sx: { name: "일대일형 (이상적인 몽상가)", description: "새로운 아이디어나 환상적인 관계에 매료됩니다. 현실의 제약보다는 상상 속의 무한한 가능성을 사랑하는 낭만주의자입니다.", questions: [{ text: "새로운 만남이나 독특한 아이디어에 금방 열광하고 몰입한다.", id: "st_7_sx_1" }, { text: "현실의 지루함을 견디기 힘들고 늘 설레는 환상을 꿈꾼다.", id: "st_7_sx_2" }] },
                        so: { name: "사회적형 (헌신적인 봉사자)", description: "집단의 행복을 위해 자신의 욕구를 기꺼이 희생하는 모습을 보입니다. 모두가 즐거운 유토피아를 꿈꾸며 긍정적인 사회 활동에 앞장섭니다.", questions: [{ text: "모두가 행복한 사회를 만들기 위해 나의 즐거움을 잠시 미룰 수 있다.", id: "st_7_so_1" }, { text: "긍정적인 비전을 공유하며 사람들에게 희망을 주는 역할을 좋아한다.", id: "st_7_so_2" }] }
                    }
                },
                8: { 
                    name: "8번: 도전자 (The Challenger)", 
                    description: "8번 유형은 강한 의지력으로 환경을 주도하며, 정의와 약자를 보호하려는 리더십을 발휘합니다.\n\n• 핵심 동기: 자신을 지키는 것, 주도권을 쥐는 것, 영향력을 행사하여 세상을 바꾸는 것.\n• 근원적 공포: 통제당하는 것, 해를 입는 것, 약해지는 것.\n• 건강할 때: 너그럽고 자비로우며, 압제에 저항하고 세상을 더 나은 곳으로 이끄는 영웅적인 지도자가 됩니다.\n• 스트레스 받을 때: 5번 유형처럼 변하여, 갑자기 침묵에 빠지고 사람들과 거리를 두며 고립될 수 있습니다.\n\n💡 성장 포인트: 부드러움을 두려워하지 마세요. 당신의 약점까지 드러낼 때 진정한 강함이 완성됩니다.", 
                    subtypes: {
                        sp: { name: "자기보존형 (강인한 생존자)", description: "자신과 가족의 생존에 필요한 자원을 확보하는 데 매우 단호합니다. 말이 적고 행동으로 자신의 영역을 지키는 실전가형입니다.", questions: [{ text: "내 사람들과 내 자산을 지키기 위해서라면 어떤 위협에도 맞선다.", id: "st_8_sp_1" }, { text: "말보다는 실질적인 행동으로 내 존재감과 영역을 증명한다.", id: "st_8_sp_2" }] },
                        sx: { name: "일대일형 (관계를 장악하는 자)", description: "관계에서 강한 소유욕과 에너지를 발산합니다. 카리스마를 통해 상대의 마음을 정복하거나 파괴적인 열정을 보여주기도 합니다.", questions: [{ text: "관계에서도 내가 주도권을 쥐고 상대를 압도하는 것을 즐긴다.", id: "st_8_sx_1" }, { text: "나에게 도전해오는 강한 상대에게 묘한 매력과 승부욕을 느낀다.", id: "st_8_sx_2" }] },
                        so: { name: "사회적형 (정의로운 보호자)", description: "자신이 속한 집단의 이익과 정의를 위해 싸웁니다. 약자를 괴롭히는 권력에 당당히 맞서는 의리 있는 리더의 전형입니다.", questions: [{ text: "부당한 권력에 맞서 약자를 보호하는 것이 나의 사명이라 믿는다.", id: "st_8_so_1" }, { text: "내 집단과 동료들을 위해서라면 기꺼이 총대를 메고 앞장선다.", id: "st_8_so_2" }] }
                    }
                },
                9: { 
                    name: "9번: 평화주의자 (The Peacemaker)", 
                    description: "9번 유형은 내면과 외면의 평화를 유지하며, 모든 것을 수용하고 조화롭게 아우르는 능력이 있습니다.\n\n• 핵심 동기: 조화를 이루는 것, 갈등을 피하는 것, 평온한 상태를 유지하는 것.\n• 근원적 공포: 연결을 잃는 것, 갈등으로 인해 분리되는 것, 평화가 깨지는 것.\n• 건강할 때: 안정적이고 수용적이며, 혼란 속에서도 평화를 만들어내는 지혜로운 중재자가 됩니다.\n• 스트레스 받을 때: 6번 유형처럼 변하여, 갑자기 불안해지고 의심이 많아지며 걱정으로 안절부절못할 수 있습니다.\n\n💡 성장 포인트: '아니오'라고 말하세요. 당신의 목소리가 들릴 때 진정한 조화가 가능해집니다.", 
                    subtypes: {
                        sp: { name: "자기보존형 (안락한 미식가)", description: "신체적인 편안함과 반복되는 일상의 안정에서 평화를 찾습니다. 먹고 마시고 쉬는 소박한 즐거움에 몰두하여 갈등을 잊으려 합니다.", questions: [{ text: "맛있는 음식과 편안한 휴식만 있다면 세상의 고민은 잊을 수 있다.", id: "st_9_sp_1" }, { text: "복잡한 문제보다는 익숙하고 소박한 일상이 유지되길 바란다.", id: "st_9_sp_2" }] },
                        sx: { name: "일대일형 (합일을 꿈꾸는 자)", description: "중요한 상대에게 자신을 완전히 맞추어 동화되려 합니다. 상대의 기분이 내 기분이 되는 합일의 평화를 추구합니다.", questions: [{ text: "사랑하는 사람의 생각이나 취향에 나를 맞추는 것이 자연스럽다.", id: "st_9_sx_1" }, { text: "상대와 완벽하게 하나가 된 느낌을 받을 때 비로소 안심한다.", id: "st_9_sx_2" }] },
                        so: { name: "사회적형 (모두의 중재자)", description: "집단 내의 소속감을 중요하게 여깁니다. 모든 사람이 만족하는 환경을 만들기 위해 집단의 분위기에 조용히 따릅니다.", questions: [{ text: "모임의 모든 사람이 즐겁고 화목하게 지내는 것에 큰 가치를 둔다.", id: "st_9_so_1" }, { text: "내 주장을 하기보다 집단의 전체적인 의견에 조용히 따르는 편이다.", id: "st_9_so_2" }] }
                    }
                }
            },
            centerQuestions: { 
                heart: [ 
                    { text: "사람들이 나를 친절하고 따뜻한 사람으로 기억해주길 바란다.", type: 2, id: "h_2_1" },
                    { text: "타인의 칭찬이나 인정이 없으면 금방 무기력해지거나 서운하다.", type: 2, id: "h_2_3" },
                    { text: "성공해서 다른 사람들이 부러워할 만한 삶을 살고 싶다.", type: 3, id: "h_3_1" },
                    { text: "경쟁이 있는 상황에서 지는 것은 견디기 힘든 고통이다.", type: 3, id: "h_3_4" },
                    { text: "남들이 느끼지 못하는 미묘한 감정이나 예술적 감각에 민감하다.", type: 4, id: "h_4_3" },
                    { text: "나를 진정으로 이해해 주는 영혼의 동반자가 있을 거라 믿는다.", type: 4, id: "h_4_5" }
                ],
                head: [ 
                    { text: "에너지가 바닥나면 반드시 혼자 있어야 충전이 된다.", type: 5, id: "hd_5_3" },
                    { text: "지식을 탐구할 때 내가 유능해지는 느낌을 받는다.", type: 5, id: "hd_5_4" },
                    { text: "신뢰할 만한 가이드라인이 없을 때 큰 불안감을 느낀다.", type: 6, id: "hd_6_5" },
                    { text: "내 선택이 틀렸을까 봐 끊임없이 의심하고 확인하곤 한다.", type: 6, id: "hd_6_9" },
                    { text: "항상 즐거운 계획을 세워야 삶이 생동감 넘친다.", type: 7, id: "hd_7_2" },
                    { text: "심각하고 어두운 이야기를 들으면 본능적으로 피하고 싶다.", type: 7, id: "hd_7_4" }
                ],
                gut: [ 
                    { text: "내 영역에 누가 간섭하면 매우 화가 난다.", type: 8, id: "g_8_1" },
                    { text: "강한 자에게는 당당히 맞서고 약한 자는 지키려 한다.", type: 8, id: "g_8_2" },
                    { text: "갈등이 생기면 원만하게 넘어가려고 애쓰는 편이다.", type: 9, id: "g_9_2" },
                    { text: "세상이 조화로운 상태일 때 비로소 평온함을 느낀다.", type: 9, id: "g_9_9" },
                    { text: "작은 실수도 용납하기 힘들고 매사에 원칙을 지키려 한다.", type: 1, id: "g_1_1" },
                    { text: "올바르지 못한 상황을 보면 즉시 바로잡고 싶은 욕구가 든다.", type: 1, id: "g_1_2" }
                ]
            }
        };

        let currentStep = 0; 
        const userChoices = { center: null, type: null, subtype: null };
        let previousChoices = []; 

        const els = {
            bar: document.getElementById('progress-bar'),
            indicator: document.getElementById('step-indicator'),
            title: document.getElementById('step-title'),
            options: document.getElementById('options-area'),
            prevBtn: document.getElementById('prev-button'),
            nextBtn: document.getElementById('next-button'),
            resultArea: document.getElementById('result-area'),
            resultContent: document.getElementById('result-content'),
            restartBtn: document.getElementById('restart-button'),
            error: document.getElementById('error-message'),
            quizUI: document.getElementById('quiz-ui')
        };

        function updateProgress() {
            const percent = ((currentStep) / 3) * 100;
            els.bar.style.width = percent + "%";
        }

        function renderStep() {
            updateProgress();
            els.options.innerHTML = ''; 
            els.error.classList.add('hidden');
            els.indicator.textContent = "Progress: " + (currentStep + 1) + " / 3";
            els.prevBtn.classList.toggle('hidden', currentStep === 0);

            if (currentStep === 0) { 
                els.title.textContent = "내면 에너지의 근원을 찾아보세요";
                enneagramData.centerIdentificationGroups.forEach(function(group) {
                    const div = document.createElement('div');
                    div.className = 'question-group';
                    div.innerHTML = '<div class="group-title gaegu">' + group.groupName + '</div>';
                    group.questions.forEach(function(q) {
                        div.appendChild(createQuestion(q.text, q.id, 'q_center_' + q.id));
                    });
                    els.options.appendChild(div);
                });
                els.nextBtn.textContent = "다음 단계로";
            } else if (currentStep === 1) { 
                els.title.textContent = "가장 가까운 나의 성향을 체크하세요"; 
                const questions = enneagramData.centerQuestions[userChoices.center.id]; 
                questions.forEach(function(q) {
                    els.options.appendChild(createQuestion(q.text, q.id, 'q_type_' + q.id));
                });
                els.nextBtn.textContent = "다음 단계로";
            } else if (currentStep === 2) { 
                els.title.textContent = "나를 움직이는 본능은 무엇인가요?";
                const selectedTypeData = enneagramData.types[userChoices.type.id];
                const groupNames = ["패턴 A", "패턴 B", "패턴 C"];
                let idx = 0;
                for (let key in selectedTypeData.subtypes) {
                    const div = document.createElement('div');
                    div.className = 'question-group';
                    div.innerHTML = '<div class="group-title gaegu">' + groupNames[idx++] + '</div>';
                    selectedTypeData.subtypes[key].questions.forEach(function(q) {
                        div.appendChild(createQuestion(q.text, q.id, 'q_subtype_' + q.id));
                    });
                    els.options.appendChild(div);
                }
                els.nextBtn.textContent = "최종 분석 결과 보기";
            } else if (currentStep === 3) { 
                displayResult();
            }
            
            if (previousChoices[currentStep]) {
                previousChoices[currentStep].forEach(function(c) {
                    const rad = document.querySelector('input[name="' + c.name + '"][value="' + c.value + '"]');
                    if (rad) rad.checked = true;
                });
            }
            els.options.scrollTop = 0;
        }

        function createQuestion(text, id, name) {
            const div = document.createElement('div');
            div.className = 'question-item';
            div.innerHTML = '<div class="question-text">' + text + '</div>' +
                '<div class="rating-guide"><span>전혀 아님</span><span>매우 그러함</span></div>' +
                '<div class="rating-grid">' +
                    [1,2,3,4,5].map(function(v) {
                        return '<input type="radio" id="' + name + '_' + v + '" name="' + name + '" value="' + v + '">' +
                            '<label for="' + name + '_' + v + '">' + v + '</label>';
                    }).join('') +
                '</div>';
            return div;
        }

        function displayResult() {
            els.quizUI.classList.add('hidden');
            els.resultArea.classList.remove('hidden');

            let centerStyle = "";
            if(userChoices.center.id === 'heart') centerStyle = "bg-rose-50 border-rose-100 text-rose-800";
            else if(userChoices.center.id === 'head') centerStyle = "bg-blue-50 border-blue-100 text-blue-800";
            else centerStyle = "bg-teal-50 border-teal-100 text-teal-800";

            els.resultContent.innerHTML = 
                '<div class="result-card shadow-sm ' + centerStyle + '">' +
                    '<h3 class="gaegu">🧭 내면의 중심 에너지</h3>' +
                    '<div class="result-body font-bold mb-2 text-lg">' + userChoices.center.name + '</div>' +
                    '<div class="result-body">' + userChoices.center.description + '</div>' +
                '</div>' +
                '<div class="result-card shadow-sm border-pink-100">' +
                    '<h3 class="gaegu text-pink-700">✨ 나의 고유 성격 유형</h3>' +
                    '<div class="result-body font-bold mb-2 text-pink-600 text-lg">' + userChoices.type.name + '</div>' +
                    '<div class="result-body">' + userChoices.type.description + '</div>' +
                '</div>' +
                '<div class="result-card shadow-sm border-indigo-100">' +
                    '<h3 class="gaegu text-indigo-700">🌟 삶의 방식: 하위 본능</h3>' +
                    '<div class="result-body font-bold mb-2 text-indigo-600 text-lg">' + userChoices.subtype.name + '</div>' +
                    '<div class="result-body">' + userChoices.subtype.description + '</div>' +
                '</div>';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        els.nextBtn.addEventListener('click', function() {
            const radios = els.options.querySelectorAll('input[type="radio"]:checked');
            const totalQuestions = els.options.querySelectorAll('.rating-grid').length;
            
            if (radios.length < totalQuestions) {
                els.error.classList.remove('hidden');
                return;
            }

            const choices = Array.from(radios).map(function(r) { return { name: r.name, value: r.value }; });
            previousChoices[currentStep] = choices;

            if (currentStep === 0) {
                const sums = { heart: 0, head: 0, gut: 0 };
                const counts = { heart: 0, head: 0, gut: 0 };
                enneagramData.centerIdentificationGroups.forEach(function(g) {
                    g.questions.forEach(function(q) {
                        const val = parseInt(document.querySelector('input[name="q_center_' + q.id + '"]:checked').value);
                        sums[q.centerTarget] += val;
                        counts[q.centerTarget]++;
                    });
                });
                const averages = {};
                Object.keys(sums).forEach(function(k) { averages[k] = sums[k] / counts[k]; });
                const dominant = Object.keys(averages).reduce(function(a, b) { return averages[a] >= averages[b] ? a : b; });
                userChoices.center = enneagramData.centers.filter(function(c) { return c.id === dominant; })[0];

            } else if (currentStep === 1) {
                const sums = {};
                const counts = {};
                const qs = enneagramData.centerQuestions[userChoices.center.id];
                qs.forEach(function(q) {
                    const val = parseInt(document.querySelector('input[name="q_type_' + q.id + '"]:checked').value);
                    sums[q.type] = (sums[q.type] || 0) + val;
                    counts[q.type] = (counts[q.type] || 0) + 1;
                });
                const averages = {};
                Object.keys(sums).forEach(function(k) { averages[k] = sums[k] / counts[k]; });
                const dominant = Object.keys(averages).reduce(function(a, b) { return averages[a] >= averages[b] ? a : b; });
                userChoices.type = Object.assign({ id: dominant }, enneagramData.types[dominant]);

            } else if (currentStep === 2) {
                const sums = { sp: 0, sx: 0, so: 0 };
                const counts = { sp: 0, sx: 0, so: 0 };
                const subs = enneagramData.types[userChoices.type.id].subtypes;
                for (let key in subs) {
                    subs[key].questions.forEach(function(q) {
                        const val = parseInt(document.querySelector('input[name="q_subtype_' + q.id + '"]:checked').value);
                        sums[key] += val;
                        counts[key]++;
                    });
                }
                const averages = {};
                Object.keys(sums).forEach(function(k) { averages[k] = sums[k] / counts[k]; });
                const dominant = Object.keys(averages).reduce(function(a, b) { return averages[a] >= averages[b] ? a : b; });
                userChoices.subtype = Object.assign({ id: dominant }, subs[dominant]);
            }

            currentStep++;
            renderStep();
        });

        els.prevBtn.addEventListener('click', function() {
            if (currentStep > 0) {
                currentStep--;
                renderStep();
            }
        });

        els.restartBtn.addEventListener('click', function() { location.reload(); });

        renderStep();
    </script>
</body>
</html>
